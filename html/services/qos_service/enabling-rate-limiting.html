

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Enabling Rate Limiting &mdash; OSS AtlasDB develop documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/release-notes.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Performance Testing" href="../../performance/index.html" />
    <link rel="prev" title="Qos Service" href="index.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> OSS AtlasDB
          

          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Services</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../key_value_services/index.html">Key Value Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lock_service/index.html">Lock Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timestamp_service/index.html">Timestamp Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timelock_service/index.html">External Timelock Service</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Qos Service</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Enabling Rate Limiting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Releases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OSS AtlasDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Services</a> &raquo;</li>
        
          <li><a href="index.html">Qos Service</a> &raquo;</li>
        
      <li>Enabling Rate Limiting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/services/qos_service/enabling-rate-limiting.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enabling-rate-limiting">
<span id="id1"></span><h1>Enabling Rate Limiting<a class="headerlink" href="#enabling-rate-limiting" title="Permalink to this headline">¶</a></h1>
<p>Currently the QoS service allows a client to configure the read and write limits and enforces these limits.
Detailed documentation is <a class="reference internal" href="../../configuration/qos_configs/qos_client_config.html#qos-client-configuration"><span class="std std-ref">here</span></a>.</p>
<p>QoS also publishes client level metrics (meters) for the following:</p>
<blockquote>
<div><cite>com.palantir.atlasdb.qos.metrics.QosMetrics.readRequestCount</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.bytesRead</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.readTime</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.rowsRead</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.estimatedBytesRead</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.estimatedRowsRead</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.writeRequestCount</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.bytesWritten</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.writeTime</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.rowsWritten</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.backoffTime</cite>
<cite>com.palantir.atlasdb.qos.metrics.QosMetrics.throttleExceptions</cite></div></blockquote>
<p>A client should ideally look at the historical values of the <code class="docutils literal notranslate"><span class="pre">bytesRead</span></code> and <code class="docutils literal notranslate"><span class="pre">bytesWritten</span></code> metrics to determine the limits.</p>
<div class="section" id="how-does-qos-rate-limit">
<h2>How does QoS rate limit?<a class="headerlink" href="#how-does-qos-rate-limit" title="Permalink to this headline">¶</a></h2>
<p>We are using the standard Java Rate limiter to enforce the rate limiting with some modifications to support adjustment.
It is not possible to estimate the number of bytes a read request is going to consume beforehand, so we request a
default number of permits from the ratelimiter (currently 100) and subsequently return some permits (if the request
returned less than a 100 bytes) or steal more permits (if the request returned more than a 100 bytes).</p>
<p>When the client has consumed the permits per second and continues making data requests to Cassandra, soft-limiting can kick in
causing the requesting thread to wait. This wait time depends on the historical requests and how much extra permits have been
consumed by the previous requests. However, to prevent client threads from waiting indefinitely, the client can configure the
<code class="docutils literal notranslate"><span class="pre">maxBackoffTime</span></code> and the rate-limiter will not cause a request to wait for more than this time.</p>
<p>If the requested number of permits cannot be made available within the <code class="docutils literal notranslate"><span class="pre">maxBackoffTime</span></code> then the rate-limiter will throw a
<code class="docutils literal notranslate"><span class="pre">RateLimitExceededException</span></code> causing the client request to fail. AtlasDB recommends that clients should map this exception
to the status code 429 (too many requests) and provides the <code class="docutils literal notranslate"><span class="pre">RateLimitExceededExceptionMapper</span></code> that can be registered
by the application server.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../performance/index.html" class="btn btn-neutral float-right" title="Performance Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Qos Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Palantir Technologies

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>